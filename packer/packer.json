{
  "_comments": [
    "Builds depend on ova file built from debian/jessie64 image; see Vagrantfile for details"
  ],
  "variables": {
    "ovf_path": "packer/debian_jessie64-8.8.1.ova",
    "ovf_md5": "009de373c05a50c9dc308c04a76703e0",
    "cloud_token": "",
    "stable_version": "1.0.0",
    "testing_version": "2.0.0-testing",
    "testing_backend_version": "2.0.0-testing",
    "stable_box_tag": "",
    "testing_box_tag": "",
    "testing_backend_box_tag": "",
    "stable_version_descr": "",
    "testing_version_descr": "Admin login: diku_admin/admin\n\nTesting version of the FOLIO demo platform, representing the most recent commits for all components. For details see http://localhost:3000/about after `vagrant up`.",
    "testing_backend_version_descr": "Admin login: diku_admin/admin\n\nTesting version of the backend FOLIO demo platform, representing the most recent commits for all components. For details see http://localhost:9130/_/discovery/modules after `vagrant up`."
  },
  "builders": [
    {
      "name": "stable",
      "type": "virtualbox-ovf",
      "headless": true,
      "source_path": "{{ user `ovf_path` }}",
      "checksum": "{{ user `ovf_md5` }}",
      "checksum_type": "md5",
      "ssh_username": "vagrant",
      "ssh_private_key_file": "packer/vagrant_key.txt",
      "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
    },
    {
      "name": "testing",
      "type": "virtualbox-ovf",
      "headless": true,
      "source_path": "{{ user `ovf_path` }}",
      "checksum": "{{ user `ovf_md5` }}",
      "checksum_type": "md5",
      "ssh_username": "vagrant",
      "ssh_private_key_file": "packer/vagrant_key.txt",
      "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
    },
    {
      "name": "testing-backend",
      "type": "virtualbox-ovf",
      "headless": true,
      "source_path": "{{ user `ovf_path` }}",
      "checksum": "{{ user `ovf_md5` }}",
      "checksum_type": "md5",
      "ssh_username": "vagrant",
      "ssh_private_key_file": "packer/vagrant_key.txt",
      "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
    }
  ],
  "provisioners": [
    {
      "type": "ansible",
      "playbook_file": "./folio.yml",
      "groups": [
        "stable",
        "vagrant",
        "folio-backend",
        "stripes",
        "packer"
      ],
      "only": ["stable"]
    },
    {
      "type": "ansible",
      "playbook_file": "./folio.yml",
      "groups": [
        "testing",
        "vagrant",
        "folio-backend",
        "stripes",
        "packer"
      ],
      "only": ["testing"]
    },
    {
      "type": "ansible",
      "playbook_file": "./folio.yml",
      "groups": [
        "testing",
        "vagrant",
        "folio-backend",
        "packer"
      ],
      "only": ["testing-backend"]
    }
  ],
  "_post-processor_comments": [
    "Post-processers must be sequenced for Vagrant Cloud upload"
  ],
  "post-processors": [
    [
      {
        "type": "vagrant",
        "vagrantfile_template": "Vagrantfile.demo",
        "only": ["stable"]
      },
      {
        "type": "vagrant-cloud",
        "box_tag": "{{ user `stable_box_tag` }}",
        "access_token": "{{ user `cloud_token`}}",
        "version": "{{ user `stable_version`}}",
        "version_description": "{{ user `stable_version_descr` }}",
        "only": ["stable"]
      },
      {
        "type": "vagrant",
        "vagrantfile_template": "Vagrantfile.demo",
        "only": ["testing"]
      },
      {
        "type": "vagrant-cloud",
        "box_tag": "{{ user `testing_box_tag` }}",
        "access_token": "{{ user `cloud_token`}}",
        "version": "{{ user `testing_version`}}.{{ isotime \"20060102\" }}",
        "version_description": "{{ user `testing_version_descr` }}",
        "only": ["testing"]
      },
      {
        "type": "vagrant",
        "vagrantfile_template": "Vagrantfile.backend",
        "only": ["testing-backend"]
      },
      {
        "type": "vagrant-cloud",
        "box_tag": "{{ user `testing_backend_box_tag` }}",
        "access_token": "{{ user `cloud_token`}}",
        "version": "{{ user `testing_backend_version`}}.{{ isotime \"20060102\" }}",
        "version_description": "{{ user `testing_backend_version_descr` }}",
        "only": ["testing-backend"]
      }
    ]
  ]
}
